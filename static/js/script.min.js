const qrcode=window.qrcode,video=document.createElement("video"),canvasElement=document.getElementById("qr-canvas"),canvas=canvasElement.getContext("2d"),qrResult=document.getElementById("qr-result"),outputData=document.getElementById("outputData"),btnScanQR=document.getElementById("btn-scan-qr");let scanning=!1;function tick(){canvasElement.height=video.videoHeight,canvasElement.width=video.videoWidth,canvas.drawImage(video,0,0,canvasElement.width,canvasElement.height),scanning&&requestAnimationFrame(tick)}function scan(){try{qrcode.decode()}catch(e){setTimeout(scan,300)}}qrcode.callback=e=>{e&&(outputData.innerText=e,scanning=!1,video.srcObject.getTracks().forEach((e=>{e.stop()})),qrResult.hidden=!1,canvasElement.hidden=!0,btnScanQR.hidden=!1)},btnScanQR.onclick=()=>{navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}).then((function(e){scanning=!0,qrResult.hidden=!0,btnScanQR.hidden=!0,canvasElement.hidden=!1,video.setAttribute("playsinline",!0),video.srcObject=e,video.play(),tick(),scan()}))};